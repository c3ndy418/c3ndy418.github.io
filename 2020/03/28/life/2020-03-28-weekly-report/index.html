<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="i0gan">
    
    <title>
        
            2020-03-28 周报 |
        
        I0gan&#39; life
    </title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="shortcut icon" href="/images/logo.svg">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh"};
    KEEP.theme_config = {"toc":{"enable":false,"number":false,"expand_all":false,"init_open":false},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.jpg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving."},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":false},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.4.0"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days age","week":"%s weeks age","month":"%s months age","year":"%s years age"};
  </script>
<meta name="generator" content="Hexo 5.3.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            <a class="logo-title" href="/">
                I0gan&#39; life
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">2020-03-28 周报</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">i0gan</span>
                        
                            <span class="author-label">Lv2</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2020-03-28 18:24:50
    </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/weekly-report/">weekly report</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h1 id="2020-03-28-周报"><a href="#2020-03-28-周报" class="headerlink" title="2020-03-28 周报"></a>2020-03-28 周报</h1><h3 id="这周在干什么"><a href="#这周在干什么" class="headerlink" title="这周在干什么?"></a>这周在干什么?</h3><p>百变不离其宗,正在学习heap的各种套路<br>目前先对堆进行一点总结, 也是刚入门.这个星期昨天才开始搞…. <del>_</del>…..可悲可悲….</p>
<h4 id="先说一下各种常见的hook吧-堆中常见"><a href="#先说一下各种常见的hook吧-堆中常见" class="headerlink" title="先说一下各种常见的hook吧 (堆中常见)."></a>先说一下各种常见的hook吧 (堆中常见).</h4><p>__malloc_hook<br>这是一个函数指针变量，指向的是：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> * <span class="title">function</span><span class="params">(<span class="keyword">size_t</span> size, <span class="keyword">void</span> * caller)</span> </span></span><br></pre></td></tr></table></figure>
<p>其中caller是表示在栈中调用malloc的函数的时候的函数地址，%p可以打印出他的地址</p>
<ul>
<li>__free_hook<br> 同样这个也是一个函数指针变量，指向的是：</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">function</span><span class="params">(<span class="keyword">void</span> * ptr, <span class="keyword">void</span> * caller)</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>__realloc_hook<br> 这也是指向一个函数指针变量，指向的是:</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> * <span class="title">function</span><span class="params">(<span class="keyword">void</span> * ptr ,<span class="keyword">size_t</span> size, <span class="keyword">void</span> * caller)</span></span></span><br></pre></td></tr></table></figure>
<p>__memalign_hook<br> 这个函数是指向的一个函数指针，不过是：<br> aligned_alloc, memalign, posix_memalign and valloc</p>
<p>__malloc_initialize_hook</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> (*__malloc_initialize_hook) (<span class="keyword">void</span>) = my_init_hook;</span><br></pre></td></tr></table></figure>
<p>是一个弱类型，只是在初始化的时候使用一次</p>
<h4 id="使用原理"><a href="#使用原理" class="headerlink" title="使用原理"></a>使用原理</h4><p>hook函数只是对malloc realloc以及free等函数有一个包装，即每当调用了这些函数后，利用hook函数，可以得到我们想要的结果，比如当前调用的动态分配内存函数的地址，hook变量的值等等,这样在debug的时候，可以知道内存泄漏的地点 </p>
<p>言归正传, 所以才会有malloc_hook修改可以实现任意目标函数执行</p>
<h4 id="一般分为以下几种劫持"><a href="#一般分为以下几种劫持" class="headerlink" title="一般分为以下几种劫持"></a>一般分为以下几种劫持</h4><p>got劫持, iofile劫持打OneGadget, hook劫持</p>
<h4 id="怎样获取libc基地址"><a href="#怎样获取libc基地址" class="headerlink" title="怎样获取libc基地址"></a>怎样获取libc基地址</h4><p>若没有dump函数, 可以修改free的got表为puts,然后构造好参数, 实现dump出libc中函数的地址,即可以获取libc基地址.<br>若remove掉时,没有对指针清空, 可以通过对溢出构造fake chunk实现unlink时得到main_arena地址, 计算偏移就可得到libc基地址.</p>
<h4 id="如何实现任意地址修改"><a href="#如何实现任意地址修改" class="headerlink" title="如何实现任意地址修改"></a>如何实现任意地址修改</h4><p>最关键的还是看题中的逻辑漏洞<br>比如 easyheap, babyfenshui 中添加一个item,就会malloc两个堆.就找第一个堆与第二个堆的逻辑漏洞.比如,先创建第一堆,然后再作判断漏洞<br>一般情况下,常用的还是 fastbin attack来实现 write anything anywhere.</p>
<p>上面是小白的我,进行一些基础的总结, 其实远远不止这些, 下面是正在学习的套路术语</p>
<h4 id="Off-by-one"><a href="#Off-by-one" class="headerlink" title="Off by one"></a>Off by one</h4><p>在向缓冲区输入的时,可以越界一个字节可以控制,其利用一根据题中还存在的其他漏洞来判定</p>
<h4 id="House-of-Force"><a href="#House-of-Force" class="headerlink" title="House of Force"></a>House of Force</h4><p>利用堆溢出修改top chunk 大小,一般采用负数来修改到大的值. 计算目标地址与top chunk的地址之差, 然后在malloc的时候设置大小为这个差值,就可以实现 write anythen anywhere.</p>
<p>一方面,需要绕过REQUEST_OUT_RANGE(req)检测, 即传给malloc的值在负数范围内,不得大于-2 * MINSIZE.一般这个情况都是满足的.</p>
<h4 id="House-Of-Einherjar"><a href="#House-Of-Einherjar" class="headerlink" title="House Of Einherjar"></a>House Of Einherjar</h4><p>控制 prev_size和prev_inuse字段, 可以将新malloc出来的chunk指向 anywhere</p>
<p>一般情况下, 就可以使用off by one 漏洞覆盖prev_inuse, 通过 fake chunk绕过 unlink检测.</p>
<p>控制prev_size和prev_inuse字段需要满足:chunk_at_offset(p, -((long) prevsize)), 所以直接算目标地址与当前chunk的差值.</p>
<h3 id="Unlink"><a href="#Unlink" class="headerlink" title="Unlink"></a>Unlink</h3><p>unlink就是将双向链表中的空闲块取出来,然后和目前相邻的 free 掉的chunk进行合并</p>
<p>目前也正在学习, 大概就先说这么多…</p>
<h3 id="这周遇到的问题"><a href="#这周遇到的问题" class="headerlink" title="这周遇到的问题"></a>这周遇到的问题</h3><p>生活琐事: 自己在转转购买东西, 天天催发货, 后面发货发错了,我就要求商家退款,可是商家不退, 我前天就搞一上午的信息搜集,正准备采用这招搞他, 后面还是想想, 若才用这招威胁, 可能一分钱也得不到, 人的心也是肉做的, 采用社工的方式,求个情, 然后后面就退钱了, 被坑400.唉,耽误时间有浪费钱啊.下次不再在转转平台上买东西了.(其实这个东西我后面了解到, 是违反法律的黑产, 违法刑法155条, 损失400块就当作是个教训, 买东西还是到正规的店中去买, 不要贪图便宜) </p>
<p>对于堆利用, 常挂在嘴边说, 就是没有好好做, 反省一下自己, 以后天天搞.向师傅们学习.</p>
<h3 id="下周计划"><a href="#下周计划" class="headerlink" title="下周计划"></a>下周计划</h3><p>把各种套路理清楚, 跟着师傅们的思路走, 整理各种脚本, 方便真正开打的时候直接上脚本,也要学习一下如何批量提交flag脚本.</p>
<p>只要学不死, 就望死里学……下周的我…</p>

        </div>

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2020/06/18/life/university-plan/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">大学计划</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2020/03/16/life/2020-03-16-weekly-report/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">2020-03-16 周报</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;评论</i>
    </div>
    

        
            


        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>&nbsp;-&nbsp;
            
            2021&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">i0gan</a>
        </div>
        
            <script async  src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                
            </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.0</a>
        </div>
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/header-shrink.js"></script><script src="/js/back2top.js"></script><script src="/js/dark-light-toggle.js"></script>


    <script src="/js/local-search.js"></script>



    <script src="/js/code-copy.js"></script>




<div class="post-scripts">
    
</div>



</body>
</html>
